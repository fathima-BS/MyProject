<%- include("../partials/user/header") %>

<style>
    *{
        margin: 0;
    }
  /* Modern Product Detail Page Styling */
  .product-main-container {
    font-family: 'Arial', sans-serif;
  }

  .product-detail-section {
    display: flex;
    gap: 30px;
    background: #fff;
    padding: 10px 150px 34px 56px;
    border-radius: 10px;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
  }

  .image-gallery {
    flex: 1;
    max-width: 500px;
    position: relative;
  }

  /* Image zoom container */
  .zoom-container {
    width: 100%;
    height: 500px;
    position: relative;
    overflow: hidden;
    border-radius: 8px;
    margin-bottom: 10px;
  }

  /* Main product image */
  .main-image {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.1s ease;
    cursor: zoom-in;
  }

  .thumbnail-container {
    display: flex;
    gap: 10px;
    overflow-x: auto;
    padding-bottom: 5px;
  }

  .thumbnail {
    width: 80px;
    height: 80px;
    object-fit: cover;
    border-radius: 5px;
    cursor: pointer;
    border: 2px solid transparent;
    transition: border-color 0.3s;
  }

  .thumbnail:hover,
  .thumbnail.active {
    border-color: #007bff;
  }

  .product-info {
    flex: 1;
    padding: 20px;
    margin: 10px;
  }

  .product-title {
    font-size: 28px;
    font-weight: 700;
    color: #333;
    margin-bottom: 13px;
  }

  .brand-name {
    font-size: 18px;
    color: #666;
    margin-bottom: 15px;
  }

  .price-section {
    display: flex;
    align-items: center;
    gap: 15px;
    margin-bottom: 20px;
  }

  .sale-price {
    font-size: 24px;
    font-weight: 700;
    color: #28a745;
  }

  .regular-price {
    font-size: 18px;
    color: #999;
    text-decoration: line-through;
  }

  .offer-badge {
    background: #ff4444;
    color: #fff;
    padding: 5px 10px;
    border-radius: 15px;
    font-size: 14px;
  }

  .product-description {
    font-size: 17px;
    color: #555;
    line-height: 1.6;
    margin-bottom: 20px;
    max-height: 100px;
    overflow-y: auto;
    margin-right: 230px;
  }

  .status-quantity {
    display: flex;
    gap: 20px;
    margin-bottom: 20px;
  }

  .status {
    font-size: 14px;
    color: #28a745;
    font-weight: 600;
  }

  .quantity {
    font-size: 14px;
    color: #333;
  }

  .action-buttons {
    display: flex;
    gap: 10px;
    width: 400px;
    margin-bottom: 20px;
  }

  .add-to-cart-btn,
  .wishlist-btn {
    padding: 12px 20px;
    border: none;
    border-radius: 25px;
    cursor: pointer;
    font-size: 14px;
    transition: all 0.3s ease;
  }

  .add-to-cart-btn {
    background: #28a745;
    color: #fff;
    flex: 1;
  }

  .add-to-cart-btn:hover {
    background: #218838;
    transform: translateY(-2px);
  }

  .wishlist-btn {
    background: #fff;
    color: #ff4444;
    border: 1px solid #ddd;
  }

  .wishlist-btn:hover {
    background: #ff4444;
    color: #fff;
    transform: translateY(-2px);
  }

  .additional-info {
    border-top: 1px solid #eee;
    padding-top: 20px;
  }

  .info-title {
    font-size: 16px;
    font-weight: 700;
    color: #333;
    margin-bottom: 10px;
  }

  .info-list {
    list-style: none;
    padding: 0;
    font-size: 14px;
    color: #555;
  }

  .info-list li {
    margin-bottom: 8px;
    display: flex;
    justify-content: space-between;
  }

  .info-list li span:first-child {
    font-weight: 600;
  }

  /* Responsive Design */
  @media (max-width: 768px) {
    .product-detail-section {
      flex-direction: column;
    }

    .image-gallery {
      max-width: 100%;
    }

    .zoom-container {
      height: 300px;
    }
  }
  .related-products {
    margin-top: 40px;
    padding: 20px;
    background: #fff;
    border-radius: 10px;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
  }

  .related-title {
    font-size: 24px;
    font-weight: 700;
    color: #333;
    margin-bottom: 20px;
    text-align: center;
    position: relative;
  }

  .related-title::after {
    content: '';
    position: absolute;
    bottom: -5px;
    left: 50%;
    transform: translateX(-50%);
    width: 50px;
    height: 3px;
    background: #007bff;
    border-radius: 2px;
  }

  .product-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr); /* Exactly 4 columns */
    gap: 20px;
  }

  .product-card {
    background: #fff;
    border-radius: 8px;
    padding: 15px;
    text-align: center;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    transition: transform 0.3s;
    position: relative;
  }

  .product-card:hover {
    transform: translateY(-5px);
  }

  .product-card img {
    max-width: 100%;
    height: auto;
    border-radius: 5px;
    margin-bottom: 10px;
  }

  .wishlist-btn {
    top: 10px;
    right: 10px;
    background: rgba(255, 255, 255, 0.8);
    color: #ff4444;
    padding: 8px;
    border-radius: 50%;
    cursor: pointer;
    border: 1px solid #ddd;
    transition: color 0.3s;
  }

  .wishlist-btn:hover {
    color: #ff0000;
  }

  .add-to-cart-btn {
    background: #28a745;
    color: #fff;
    padding: 10px;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    margin-top: 10px;
    transition: background 0.3s;
  }
  .add-to-cart {
    background: #111512;
    color: #fff;
    padding: 10px;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    margin-top: 10px;
    transition: background 0.3s;
  }

  .add-to-cart-btn:hover {
    background: #218838;
  }

  /* Responsive Design */
  @media (max-width: 992px) {
    .product-grid {
      grid-template-columns: repeat(2, 1fr); /* 2 columns on medium screens */
    }
  }

  @media (max-width: 576px) {
    .product-grid {
      grid-template-columns: 1fr; /* 1 column on small screens */
    }
  }
</style>

<div class="product-main-container">
  <section class="product-detail-section">
    <!-- Image Gallery -->
    <div class="image-gallery">
      <div class="zoom-container" id="zoomContainer">
        <img src="<%= product.productImage[0] %>" alt="Bullet Trolley" class="main-image" id="mainImage">
      </div>
      <div class="thumbnail-container">
        <% product.productImage.forEach((image, index) => { %>
          <img src="<%= image %>" alt="<%= product.productName %> Thumbnail <%= index + 1 %>" class="thumbnail <%= index === 0 ? 'active' : '' %>" onclick="changeImage(this)">
        <% }) %>
      </div>
    </div>

    <!-- Product Information -->
    <div class="product-info">
      <h1 class="product-title"><%= title %></h1>
      <p class="brand-name"><%= product.brand.BrandName %></p>

      <div class="price-section">
        <span class="sale-price">₹<%= product.salePrice %></span>
        <span class="regular-price">₹<%= product.regularPrice %></span>
        <span class="offer-badge">20% OFF</span>
      </div>

      <p class="product-description"><%= product.description %></p>

      <div class="status-quantity">
        <span class="status">Status: <%= product.status %></span>
        <span class="quantity">Quantity: <%= product.quantity%> in stock</span>
      </div>

      <div class="action-buttons">
        <button class="add-to-cart-btn">Add to Cart</button>
        <button class="add-to-cart">❤️ Add to Wishlist</button>
      </div>

      
    </div>
  </section>
  <section>
    <div class="related-products">
        <h3 class="related-title">Related Products</h3>
        <div class="product-grid">
          <% if (relatedProducts && relatedProducts.length > 0) { %>
            <% relatedProducts.forEach(product => { %>
              <div class="product-card">
                <span class="wishlist-btn" onclick="addToWishlist('<%= product._id %>')">❤️</span>
                <a href="/productDetail?productId=<%= product._id %>">
                  <img src="<%= product.productImage[0] %>" alt="<%= product.productName || 'Product Image' %>" />
                  <h4><%= product.productName %></h4>
                  <h6><%= product.brand ? product.brand.BrandName : 'Unknown Brand' %></h6>
                  <p>₹ <%= product.salePrice.toFixed(2) %> <span class="text-muted"><strike>₹ <%= product.regularPrice.toFixed(2) %></strike></span></p>
                </a>
                <button class="add-to-cart-btn" onclick="addToCart('<%= product._id %>')">Add to Cart</button>
              </div>
            <% }) %>
          <% } else { %>
            <p style="text-align: center; color: #666;">No related products found.</p>
          <% } %>
        </div>
      </div>
</section>

<script>
  function changeImage(element) {
    // Update main image
    document.getElementById('mainImage').src = element.src;
    
    // Update active thumbnail
    document.querySelectorAll('.thumbnail').forEach(thumb => {
      thumb.classList.remove('active');
    });
    element.classList.add('active');
  }

  // Image zoom functionality
  document.addEventListener('DOMContentLoaded', function() {
    const image = document.getElementById('mainImage');
    const container = document.getElementById('zoomContainer');
    
    // Set scale factor - how much to zoom
    const ZOOM_SCALE = 2.5;
    
    container.addEventListener('mouseenter', function() {
      image.style.transformOrigin = '0 0';
    });
    
    container.addEventListener('mousemove', function(e) {
      // Calculate mouse position relative to container
      const containerRect = container.getBoundingClientRect();
      const xPos = (e.clientX - containerRect.left) / containerRect.width;
      const yPos = (e.clientY - containerRect.top) / containerRect.height;
      
      // Transform the image based on mouse position
      image.style.transform = `scale(${ZOOM_SCALE})`;
      image.style.transformOrigin = `${xPos * 100}% ${yPos * 100}%`;
    });
    
    container.addEventListener('mouseleave', function() {
      // Reset transform when mouse leaves
      image.style.transform = 'scale(1)';
    });
  });
</script>

<%- include("../partials/user/footer") %>